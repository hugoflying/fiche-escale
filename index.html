<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Fiche Escale Interactive</title>
  <style>
    @media print {
      button,
      [type="radio"],
      label[for] {
        display: none !important;
      }
      div[style*="position: absolute"] {
        display: none !important;
      }
    }
    body {
      font-family: sans-serif;
      padding: 10px;
      margin: auto;
      width: 100%;
      max-width: 100%;
    }
    section {
      margin-bottom: 30px;
    }
    h3 {
      background: #000;
      color: #fff;
      padding: 10px;
      margin: 0 -10px 15px;
      text-align: center;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }
    .field {
      flex: 1 1 120px;
      display: flex;
      flex-direction: column;
    }
    .field label {
      font-weight: bold;
      margin-bottom: 3px;
      font-size: 0.9em;
    }
    .field input,
    .field select,
    .field textarea {
      padding: 4px;
      font-size: 0.9em;
      text-transform: uppercase;
    }
    textarea {
      height: 150px;
      width: 100%;
    }
    .now-btn {
      margin-top: 4px;
      padding: 3px 5px;
      font-size: 0.75em;
      width: 100%;
    }
    input[readonly] {
      background-color: #eee;
      color: #555;
      font-style: italic;
      border: 1px dashed #aaa;
    }
    @media (max-width: 850px) {
      .row {
        flex-direction: column;
      }
      .field {
        flex: 1 1 100%;
      }
    }
    .input-now {
      display: flex;
      gap: 5px;
    }
    .input-now input {
      flex: 1;
    }
    .input-now button {
      width: 100px;
    }
    @media (max-width: 850px) {
      .row {
        flex-direction: column;
      }
      .field {
        flex: 1 1 100%;
      }
      .input-now {
        flex-direction: column;
      }
      .input-now button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div style="position: absolute; top: 10px; right: 20px;">
    <label><input type="radio" name="timeMode" value="local" checked onchange="setTimeMode(this.value)"> Heure locale</label>
    <label><input type="radio" name="timeMode" value="utc" onchange="setTimeMode(this.value)"> UTC</label>
  </div>
  <h2>Fiche Escale Vol</h2>

  <!-- CONTAINER PRINCIPAL -->
  <div id="formulaire-sections">
    <!-- SECTION 1 : INFORMATIONS -->
    <section>
      <h3>INFORMATIONS</h3>
      <div class="row">
        <div class="field"><label>Date</label><input type="date" id="dateField"></div>
        <div class="field"><label>Compagnie</label><input type="text"></div>
        <div class="field"><label>Vol</label><input type="text"></div>
        <div class="field"><label>Provenance</label><input type="text"></div>
        <div class="field"><label>Destination</label><input type="text"></div>
      </div>
    </section>

    <!-- SECTION 2 : HORAIRES -->
    <section>
      <h3>HORAIRES</h3>
      <div class="row">
        <div class="field"><label>SIBT</label><input type="time" id="sibt"></div>
        <div class="field"><label>AIBT</label><input type="time" id="aibt"></div>
        <div class="field"><label>SOBT</label><input type="time" id="sobt"></div>
        <div class="field"><label>AOBT</label><input type="time" id="aobt"></div>
        <div class="field"><label>EOBT</label><input type="time" id="eobt"></div>
        <div class="field"><label>HLE</label><input type="time" id="hle" readonly></div>
        <div class="field"><label>H-15</label><input type="time" id="h15" readonly></div>
      </div>
    </section>

    <!-- SECTION 3 : FAITS SAILLANTS -->
    <section>
      <h3>FAITS SAILLANTS</h3>
      <textarea placeholder="Commentaires, remarques, incidents..." style="width: 100%;"></textarea>
    </section>
  </div>

  <!-- BOUTONS ACTION -->
  <button onclick="printForm()" style="margin-top: 10px; padding: 10px 20px; font-size: 1em;">Exporter en PDF</button>
  <button onclick="clearForm()" style="margin-top: 20px; padding: 10px 20px; font-size: 1em;">Effacer</button>

<script>
function setTimeMode(mode) {
  window.timeMode = mode;
}

function setNow(id) {
  const now = new Date();
  const mode = window.timeMode || 'local';
  const hh = (mode === 'utc' ? now.getUTCHours() : now.getHours()).toString().padStart(2, '0');
  const mm = (mode === 'utc' ? now.getUTCMinutes() : now.getMinutes()).toString().padStart(2, '0');
  document.getElementById(id).value = `${hh}:${mm}`;
}

function setNowToPrevious(btn) {
  const input = btn.previousElementSibling;
  if (!input || input.tagName.toLowerCase() !== 'input') return;
  const now = new Date();
  const mode = window.timeMode || 'local';
  const hh = (mode === 'utc' ? now.getUTCHours() : now.getHours()).toString().padStart(2, '0');
  const mm = (mode === 'utc' ? now.getUTCMinutes() : now.getMinutes()).toString().padStart(2, '0');
  input.value = `${hh}:${mm}`;
}

function clearForm() {
  localStorage.removeItem('ficheEscaleData');
  const fields = document.querySelectorAll('input, select, textarea');
  fields.forEach(field => {
    if (field.type === 'checkbox') {
      field.checked = false;
    } else {
      field.value = '';
    }
  });
}

function printForm() {
  window.print();
}

function calculateTimeOffset(baseId, targetId, offsetMinutes) {
  const base = document.getElementById(baseId);
  const target = document.getElementById(targetId);
  if (!base || !target || !base.value) return;
  const [h, m] = base.value.split(":" ).map(Number);
  const baseDate = new Date();
  baseDate.setHours(h);
  baseDate.setMinutes(m);
  baseDate.setMinutes(baseDate.getMinutes() + offsetMinutes);
  const hh = baseDate.getHours().toString().padStart(2, '0');
  const mm = baseDate.getMinutes().toString().padStart(2, '0');
  target.value = `${hh}:${mm}`;
}

window.addEventListener("DOMContentLoaded", () => {
  const sobt = document.getElementById("sobt");
  if (sobt) {
    sobt.addEventListener("change", () => {
      calculateTimeOffset("sobt", "hle", -40);
      calculateTimeOffset("sobt", "h15", -15);
    });
  }
});
</script>
</body>
</html>
