<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Fiche Escale Interactive</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 10px;
      margin: auto;
      width: 100%;
      max-width: 100%;
    }
    section {
      margin-bottom: 30px;
    }
    h3 {
      background: #000;
      color: #fff;
      padding: 10px;
      margin: 0 -10px 15px;
      text-align: center;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }
    .field {
      flex: 1 1 120px;
      display: flex;
      flex-direction: column;
    }
    .field label {
      font-weight: bold;
      margin-bottom: 3px;
      font-size: 0.9em;
    }
    .field input,
    .field select,
    .field textarea {
      padding: 4px;
      font-size: 0.9em;
    }
    textarea {
      height: 150px;
      width: 100%;
    }
    .now-btn {
      margin-top: 4px;
      padding: 3px 5px;
      font-size: 0.75em;
    }
  </style>
</head>
<body>
  <div style="position: absolute; top: 10px; right: 20px; font-size: 0.9em;">
    <label><input type="radio" name="timeMode" value="local" checked onchange="setTimeMode(this.value)"> Heure locale</label>
    <label><input type="radio" name="timeMode" value="utc" onchange="setTimeMode(this.value)"> UTC</label>
  </div>
  <h2>Fiche Escale Vol</h2>

<!-- SECTION 1 : INFORMATIONS -->
<section>
  <h3>INFORMATIONS</h3>
  <div class="row">
    <div class="field"><label>Date</label><input type="date" id="dateField"></div>
    <div class="field"><label>Compagnie</label><select id="compagnie">
      <option>FR</option><option>RK</option><option>W4</option><option>W6</option><option>H4</option>
      <option>H6</option><option>U5</option><option>V7</option><option>Autre</option>
    </select></div>
    <div class="field"><label>N° de vol départ</label><input type="number" inputmode="numeric" pattern="[0-9]*" inputmode="numeric" pattern="[0-9]*"></div>
    <div class="field"><label>Provenance</label><input type="text" maxlength="3"></div>
    <div class="field"><label>Destination</label><input type="text" maxlength="3"></div>
    <div class="field"><label>RZA</label><input type="text" maxlength="3"></div>
    <div class="field"><label>Immatriculation</label><input type="text"></div>
    <div class="field"><label>Type avion</label><select>
      <option>B737-800 Y189</option><option>B737-8200 Y197</option><option>A320 Y180</option>
      <option>A320 Y186</option><option>A20N Y186</option><option>A321 Y230</option><option>A21N Y239</option>
    </select></div>
    <div class="field"><label>Parking</label><select>
      <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
      <option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
      <option>11</option><option>12</option>
    </select></div>
  </div>
</section>

<!-- SECTION 2 : HORAIRES -->
<section>
  <h3>HORAIRES</h3>
  <div class="row">
    <div class="field"><label>SIBT</label><input type="time" id="sibt"></div>
    <div class="field"><label>AIBT</label><input type="time" id="aibt"><button class="now-btn" style="width: 100%;" onclick="setNow('aibt')">Now</button></div>
    <div class="field"><label>SOBT</label><input type="time" id="sobt"></div>
    <div class="field"><label>AOBT</label><input type="time" id="aobt"><button class="now-btn" onclick="setNow('aobt')">Now</button></div>
    <div class="field"><label>EOBT</label><input type="time" id="eobt"></div>
    <div class="field"><label>HLE</label><input type="time" id="hle" readonly></div>
    <div class="field"><label>H-15</label><input type="time" id="h15" readonly></div>
  </div>
</section>

<!-- SECTION 3 : TIMING ESCALE -->
<section>
  <h3>TIMING ESCALE</h3>
  <div class="row">
    <div class="field"><label>Arrivée PNT avion</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Arrivée PNC avion</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Premier pax OUT</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Dernier pax OUT</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
  </div>
  <div class="row">
    <div class="field"><label>Premier pax IN</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Dernier pax IN</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Arrivée INAD</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Fermeture porte avion</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
  </div>
  <div class="row">
    <div class="field"><label>Arrivée fuel</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Départ fuel</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Arrivée lift</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Départ lift</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
  </div>
  <div class="row">
    <div class="field"><label>Arrivée NAYAK</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Départ NAYAK</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
  </div>
</section>

<!-- SECTION 4 : CHARGEMENT -->
<section>
  <h3>ASSISTANCES</h3>
  <div class="row">
    <div class="field">
      <label>Nombre d'assistances</label>
      <input type="number" id="assistanceCount" min="0" onchange="renderAssistances()" inputmode="numeric" pattern="[0-9]*" placeholder="Nombre d'assistances">
    </div>
  </div>
  <div class="row" id="assistancesContainer"></div>
</section>

<!-- SECTION 5 : PRESTATIONS -->
<section>
  <h3>PRESTATIONS</h3>
  <div class="row">
    <div class="field"><label><input type="checkbox" checked> GPU</label></div>
    <div class="field"><label><input type="checkbox"> ASU</label></div>
    <div class="field"><label><input type="checkbox" id="collecteOrdures"> Collecte d'ordures</label></div>
    <div class="field"><label><input type="checkbox" id="eauPotable"> Eau potable</label></div>
    <div class="field"><label><input type="checkbox" id="vidangeToilettes"> Vidange toilettes</label></div>
    <div class="field"><label><input type="checkbox"> Échelle supplémentaire</label></div>
    <div class="field"><label><input type="checkbox"> Dégivrage</label></div>
    <div class="field"><label><input type="checkbox"> Toilet kit</label></div>
    <div class="field"><label><input type="checkbox"> Flux par le RZA</label></div>
    <div class="field"><label><input type="checkbox"> Ménage Assist'Air</label></div>
    <div class="field">
      <label>Ménage Atalian</label>
      <select id="menageAtalian">
        <option value="">--</option>
        <option value="Full">Full</option>
        <option value="Tidy">Tidy</option>
      </select>
    </div>
    <div class="field"><label><input type="checkbox"> Push-Pull</label></div>
  </div>
</section>

<!-- SECTION 6 : FAITS SAILLANTS -->
<section>
  <h3>FAITS SAILLANTS</h3>
  <textarea></textarea>
</section>



<script>
function setNow(id) {
  const now = new Date();
  const mode = window.timeMode || 'local';
  const hh = (mode === 'utc' ? now.getUTCHours() : now.getHours()).toString().padStart(2, '0');
  const mm = (mode === 'utc' ? now.getUTCMinutes() : now.getMinutes()).toString().padStart(2, '0');
  document.getElementById(id).value = `${hh}:${mm}`;
}:${mm}`;
}:${mm}`;
}

function setNowToPrevious(btn) {
  const input = btn.previousElementSibling;
  const now = new Date();
  const mode = window.timeMode || 'local';
  const hh = (mode === 'utc' ? now.getUTCHours() : now.getHours()).toString().padStart(2, '0');
  const mm = (mode === 'utc' ? now.getUTCMinutes() : now.getMinutes()).toString().padStart(2, '0');
  input.value = `${hh}:${mm}`;
}:${mm}`;
}:${mm}`;
}

function renderAssistances() {
  const container = document.getElementById('assistancesContainer');
  const count = parseInt(document.getElementById('assistanceCount').value || '0');
  container.innerHTML = '';
  for (let i = 0; i < count; i++) {
    const wrapper = document.createElement('div');
    wrapper.className = 'field';
    const assistanceId = `assistance-type-${i}`;
    const equipId = `equipment-${i}`;
    const codeId = `code-autre-${i}`;
    wrapper.innerHTML = `
      <label>Assistance ${i + 1}</label>
      <select id="${assistanceId}" onchange="toggleAutreCode('${assistanceId}', '${codeId}')">
        <option>-</option>
        <option>WCHR</option>
        <option>WCHS</option>
        <option>WCHC</option>
        <option>DEAF</option>
        <option>MUTE</option>
        <option>DPNA</option>
        <option>Autre</option>
      </select>
      <label>Équipement ${i + 1}</label>
      <select id="${equipId}"><option>-</option><option>WCMP</option><option>WCLB</option><option>WCBD</option></select>
      <label>Siège ${i + 1}</label>
      <input type="text" placeholder="ex: 12A">
      <div class="field" id="${codeId}" style="display:none;">
        <label>Code Autre ${i + 1}</label>
        <input type="text" placeholder="Entrer le code personnalisé">
      </div>
    `;
    container.appendChild(wrapper);
  }
}
function renderExtraSeatTypes() {
  const container = document.getElementById('extraSeatTypes');
  const count = parseInt(document.getElementById('extraSeat').value || '0');
  container.innerHTML = '';
  for (let i = 0; i < count; i++) {
    const wrapper = document.createElement('div');
    wrapper.className = 'field';
    const label = document.createElement('label');
    label.textContent = `Extra seat ${i + 1} type`;
    const select = document.createElement('select');
    select.innerHTML = '<option value="M">M</option><option value="X">X</option>';
    wrapper.appendChild(label);
    wrapper.appendChild(select);
    container.appendChild(wrapper);
  }
}

function renderGateBagTypes() {
  const container = document.getElementById('gateBagTypes');
  const count = parseInt(document.getElementById('gateBags').value || '0');
  container.innerHTML = '';
  for (let i = 0; i < count; i++) {
    const wrapper = document.createElement('div');
    wrapper.className = 'field';
    const label = document.createElement('label');
    label.textContent = `Gate Bag ${i + 1} type`;
    const select = document.createElement('select');
    select.innerHTML = '<option value="PRAM">PRAM</option><option value="BAG">BAG</option>';
    wrapper.appendChild(label);
    wrapper.appendChild(select);
    container.appendChild(wrapper);
  }
}
function calculateTimeOffset(baseId, targetId, offsetMinutes) {
  const base = document.getElementById(baseId);
  const target = document.getElementById(targetId);
  if (!base || !target || !base.value) return;

  const [h, m] = base.value.split(":").map(Number);
  const baseDate = new Date();
  baseDate.setHours(h);
  baseDate.setMinutes(m);
  baseDate.setMinutes(baseDate.getMinutes() + offsetMinutes);

  const hh = baseDate.getHours().toString().padStart(2, '0');
  const mm = baseDate.getMinutes().toString().padStart(2, '0');
  target.value = `${hh}:${mm}`;
}

document.getElementById("sobt").addEventListener("change", () => {
  calculateTimeOffset("sobt", "hle", -40);
  calculateTimeOffset("sobt", "h15", -15);
});
function toggleAutreCode(selectId, codeDivId) {
  const selected = document.getElementById(selectId).value;
  const div = document.getElementById(codeDivId);
  if (selected === "Autre") {
    div.style.display = "block";
  } else {
    div.style.display = "none";
  }
}
function setTimeMode(mode) {
  window.timeMode = mode;
}
</script>
