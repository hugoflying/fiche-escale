<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Fiche Escale Interactive</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 10px;
      margin: auto;
      width: 100%;
      max-width: 100%;
    }
    section {
      margin-bottom: 30px;
    }
    h3 {
      background: #000;
      color: #fff;
      padding: 10px;
      margin: 0 -10px 15px;
      text-align: center;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }
    .field {
      flex: 1 1 120px;
      display: flex;
      flex-direction: column;
    }
    .field label {
      font-weight: bold;
      margin-bottom: 3px;
      font-size: 0.9em;
    }
    .field input,
    .field select,
    .field textarea {
      padding: 4px;
      font-size: 0.9em;
    }
    textarea {
      height: 150px;
      width: 100%;
    }
    .now-btn {
      margin-top: 4px;
      padding: 3px 5px;
      font-size: 0.75em;
    }
  </style>
</head>
<body>
  <h2>Fiche Escale Vol</h2>

<!-- SECTION 1 : INFORMATIONS -->
<section>
  <h3>INFORMATIONS</h3>
  <div class="row">
    <div class="field"><label>Date</label><input type="date" id="dateField"></div>
    <div class="field"><label>Compagnie</label><select id="compagnie">
      <option>FR</option><option>RK</option><option>W4</option><option>W6</option><option>H4</option>
      <option>H6</option><option>U5</option><option>V7</option><option>Autre</option>
    </select></div>
    <div class="field"><label>N° de vol départ</label><input type="number" inputmode="numeric" pattern="[0-9]*" inputmode="numeric" pattern="[0-9]*"></div>
    <div class="field"><label>Provenance</label><input type="text" maxlength="3"></div>
    <div class="field"><label>Destination</label><input type="text" maxlength="3"></div>
    <div class="field"><label>RZA</label><input type="text" maxlength="3"></div>
    <div class="field"><label>Immatriculation</label><input type="text"></div>
    <div class="field"><label>Type avion</label><select>
      <option>B737-800 Y189</option><option>B737-8200 Y197</option><option>A320 Y180</option>
      <option>A320 Y186</option><option>A20N Y186</option><option>A321 Y230</option><option>A21N Y239</option>
    </select></div>
    <div class="field"><label>Parking</label><select>
      <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
      <option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
      <option>11</option><option>12</option>
    </select></div>
  </div>
</section>

<!-- SECTION 2 : HORAIRES -->
<section>
  <h3>HORAIRES</h3>
  <div class="row">
    <div class="field"><label>SIBT</label><input type="time" id="sibt"></div>
    <div class="field"><label>AIBT</label><input type="time" id="aibt"><button class="now-btn" onclick="setNow('aibt')">Now</button></div>
    <div class="field"><label>SOBT</label><input type="time" id="sobt"></div>
    <div class="field"><label>AOBT</label><input type="time" id="aobt"><button class="now-btn" onclick="setNow('aobt')">Now</button></div>
    <div class="field"><label>EOBT</label><input type="time" id="eobt"></div>
    <div class="field"><label>HLE</label><input type="time" id="hle" readonly></div>
    <div class="field"><label>H-15</label><input type="time" id="h15" readonly></div>
  </div>
</section>

<!-- SECTION 4 : CHARGEMENT -->
<section>
  <h3>CHARGEMENT</h3>
  <div class="row">
    <div class="field"><label>Adults M</label><input type="number" min="0"></div>
    <div class="field"><label>Adults F</label><input type="number" min="0"></div>
    <div class="field"><label>Childs</label><input type="number" min="0"></div>
    <div class="field"><label>Infants</label><input type="number" min="0"></div>
    <div class="field"><label>TOB</label><input type="text"></div>
  </div>
  <div class="row">
    <div class="field"><label>OA/FWD</label><input type="number"></div>
    <div class="field"><label>OB/MID</label><input type="number"></div>
    <div class="field"><label>OC/AFT</label><input type="number"></div>
    <div class="field"><label>OD</label><input type="number"></div>
    <div class="field"><label>Crew configuration</label><select><option>2/0</option><option>2/4</option><option>2/5</option><option>2/6</option><option>3/4</option><option>3/5</option><option>3/6</option><option>4/4</option><option>4/5</option><option>4/6</option></select></div>
  </div>
  <div class="row">
    <div class="field"><label>Bags</label><input type="number" min="0" id="bags"></div>
    <div class="field"><label>Poids</label><input type="number" id="poids" readonly></div>
    <div class="field"><label>Gate Bags</label><input type="number" id="gateBags" min="0" onchange="renderGateBagTypes()"></div>
    <div class="field" id="gateBagTypes"></div>
  </div>
  <div class="row">
    <div class="field"><label>Extra seat</label><input type="number" id="extraSeat" min="0" onchange="renderExtraSeatTypes()"></div>
    <div class="field" id="extraSeatTypes"></div>
  </div>
  <div class="row">
    <div class="field"><label>Block fuel</label><input type="number"></div>
    <div class="field"><label>Taxi fuel</label><input type="number"></div>
    <div class="field"><label>Trip fuel</label><input type="number"></div>
  </div>
</section>

<!-- SECTION 5 : ASSISTANCES -->
<section>
  <h3>ASSISTANCES</h3>
  <div class="row">
    <div class="field">
      <label>Types d'assistance</label>
      <input type="number" id="assistanceCount" min="0" onchange="renderAssistances()" inputmode="numeric" pattern="[0-9]*" placeholder="Nombre d'assistances">
    </div>
  </div>
  <div class="row" id="assistancesContainer"></div>
</section>

<!-- SECTION 6 : FAITS SAILLANTS -->
<section>
  <h3>FAITS SAILLANTS</h3>
  <textarea></textarea>
</section>

<!-- Correction Ligne 4 TIMING : suppression de Arrivée INAD -->
<section>
  <h3>TIMING ESCALE</h3>
  <div class="row">
    <div class="field"><label>Arrivée PNT avion</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Arrivée PNC avion</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Premier pax OUT</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Dernier pax OUT</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
  </div>
  <div class="row">
    <div class="field"><label>Premier pax IN</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Dernier pax IN</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Arrivée INAD</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Fermeture porte avion</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
  </div>
  <div class="row">
    <div class="field"><label>Arrivée fuel</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Départ fuel</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Arrivée lift</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Départ lift</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
  </div>
  <div class="row">
    <div class="field"><label>Arrivée NAYAK</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
    <div class="field"><label>Départ NAYAK</label><input type="time"><button class="now-btn" onclick="setNowToPrevious(this)">Now</button></div>
  </div>
</section>

<script>
function setNow(id) {
  const now = new Date();
  const hh = now.getHours().toString().padStart(2, '0');
  const mm = now.getMinutes().toString().padStart(2, '0');
  document.getElementById(id).value = `${hh}:${mm}`;
}

function setNowToPrevious(btn) {
  const input = btn.previousElementSibling;
  const now = new Date();
  const hh = now.getHours().toString().padStart(2, '0');
  const mm = now.getMinutes().toString().padStart(2, '0');
  input.value = `${hh}:${mm}`;
}

function renderAssistances() {
  const container = document.getElementById('assistancesContainer');
  const count = parseInt(document.getElementById('assistanceCount').value || '0');
  container.innerHTML = '';
  for (let i = 0; i < count; i++) {
    const wrapper = document.createElement('div');
    wrapper.className = 'field';
    wrapper.innerHTML = `
      <label>Assistance ${i + 1}</label>
      <select><option>WCHR</option><option>WCHS</option><option>WCHC</option><option>DEAF</option><option>MUTE</option><option>DPNA</option></select>
      <label>Équipement ${i + 1}</label>
      <select><option>WCMP</option><option>WCLB</option><option>WCBD</option></select>
      <label>Siège ${i + 1}</label>
      <input type="text" placeholder="ex: 12A">
    `;
    container.appendChild(wrapper);
  }
}
function renderExtraSeatTypes() {
  const container = document.getElementById('extraSeatTypes');
  const count = parseInt(document.getElementById('extraSeat').value || '0');
  container.innerHTML = '';
  for (let i = 0; i < count; i++) {
    const wrapper = document.createElement('div');
    wrapper.className = 'field';
    const label = document.createElement('label');
    label.textContent = `Extra seat ${i + 1} type`;
    const select = document.createElement('select');
    select.innerHTML = '<option value="M">M</option><option value="X">X</option>';
    wrapper.appendChild(label);
    wrapper.appendChild(select);
    container.appendChild(wrapper);
  }
}

function renderGateBagTypes() {
  const container = document.getElementById('gateBagTypes');
  const count = parseInt(document.getElementById('gateBags').value || '0');
  container.innerHTML = '';
  for (let i = 0; i < count; i++) {
    const wrapper = document.createElement('div');
    wrapper.className = 'field';
    const label = document.createElement('label');
    label.textContent = `Gate Bag ${i + 1} type`;
    const select = document.createElement('select');
    select.innerHTML = '<option value="PRAM">PRAM</option><option value="BAG">BAG</option>';
    wrapper.appendChild(label);
    wrapper.appendChild(select);
    container.appendChild(wrapper);
  }
}
function calculateTimeOffset(baseId, targetId, offsetMinutes) {
  const base = document.getElementById(baseId);
  const target = document.getElementById(targetId);
  if (!base || !target || !base.value) return;

  const [h, m] = base.value.split(":").map(Number);
  const baseDate = new Date();
  baseDate.setHours(h);
  baseDate.setMinutes(m);
  baseDate.setMinutes(baseDate.getMinutes() + offsetMinutes);

  const hh = baseDate.getHours().toString().padStart(2, '0');
  const mm = baseDate.getMinutes().toString().padStart(2, '0');
  target.value = `${hh}:${mm}`;
}

document.getElementById("sobt").addEventListener("change", () => {
  calculateTimeOffset("sobt", "hle", -40);
  calculateTimeOffset("sobt", "h15", -15);
});
</script>
