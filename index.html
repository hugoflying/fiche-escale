<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Turnaround Management App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #ffffff;
      padding: 15px;
    }
    .flight-card {
      background-color: #1e1e1e;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
    }
    button {
      padding: 8px 16px;
      margin-top: 5px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button.start { background-color: #388e3c; }
    button.finish { background-color: #d32f2f; }
    .hidden { display: none; }
  </style>
</head>
<body>

<h2>Liste des Vols Aujourd'hui</h2>
<div id="flights"></div>
<button onclick="exportData()">Exporter en Excel</button>

<script>
let flightsData = [
  { flightNo: "FR3214", from: "BLQ", STA: "16:55", registration: "EIIFZ", type: "B73M", STD: "17:20", stand: "11", terminal: "2", gate: "D" }
];

let actions = ["Check-In", "Boarding", "Fueling", "Crew at Aircraft"];

let timingReports = [];

function renderFlights() {
  let container = document.getElementById('flights');
  flightsData.forEach((flight, index) => {
    let flightDiv = document.createElement('div');
    flightDiv.className = 'flight-card';
    flightDiv.innerHTML = `
      <strong>Flight No: ${flight.flightNo}</strong> (${flight.from})<br>
      STA: ${flight.STA}, STD: ${flight.STD}<br>
      Reg: ${flight.registration}, Type: ${flight.type}<br>
      Stand: ${flight.stand}, Terminal: ${flight.terminal}, Gate: ${flight.gate}<br>
      <button onclick="toggleActions(${index})">Voir Actions</button>
      <div id="actions-${index}" class="hidden"></div>
    `;
    container.appendChild(flightDiv);
  });
}

function toggleActions(index) {
  let actionsDiv = document.getElementById(`actions-${index}`);
  actionsDiv.classList.toggle('hidden');
  actionsDiv.innerHTML = '';
  actions.forEach(action => {
    actionsDiv.innerHTML += `
      <div>
        <strong>${action}</strong><br>
        <button class="start" onclick="recordTime('${flightsData[index].flightNo}','${action}','start')">Start</button>
        <button class="finish" onclick="recordTime('${flightsData[index].flightNo}','${action}','finish')">Finish</button>
        <input type="time" id="manual-${flightsData[index].flightNo}-${action}" placeholder="hh:mm">
        <input type="text" id="comment-${flightsData[index].flightNo}-${action}" placeholder="Commentaires">
      </div>
    `;
  });
}

function recordTime(flightNo, action, type) {
  let now = new Date();
  let manualInput = document.getElementById(`manual-${flightNo}-${action}`).value;
  let recordedTime = manualInput || now.toTimeString().slice(0,5);
  timingReports.push({flightNo, action, type, time: recordedTime});
  alert(`${type.toUpperCase()} enregistré à ${recordedTime}`);
}

function exportData() {
  let wb = XLSX.utils.book_new();
  let ws_data = [["Flight No", "Action", "Type", "Time"]];
  timingReports.forEach(r => {
    ws_data.push([r.flightNo, r.action, r.type, r.time]);
  });
  let ws = XLSX.utils.aoa_to_sheet(ws_data);
  XLSX.utils.book_append_sheet(wb, ws, "Turnaround Data");
  XLSX.writeFile(wb, "turnaround_data.xlsx");
}

renderFlights();
</script>
</body>
</html>
