<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Traçabilité température</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

 <style>
  @import url('https://fonts.googleapis.com/css2?family=Arial&display=swap');

  body {
    font-family: Arial, sans-serif;
  }

  .grid {
    display: flex;
    flex-direction: column;
    gap: 30px;
    margin-top: 20px;
  }
  .group {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
  }
  .row.single {
    grid-template-columns: 1fr;
    justify-items: center;
  }
  .separator {
    text-align: center;
    font-weight: bold;
    font-size: 1.1em;
    margin-bottom: 5px;
  }
  .card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    text-align: center;
    padding: 10px;
    box-sizing: border-box;
    width: 100%;
  }
  .card.negatif { border-top: 5px solid #003366; }
  .card.positive { border-top: 5px solid #3399ff; }
  .card.verte { border-top: 5px solid #0f9d58; }
  .card.boisson { border-top: 5px solid #f4b400; }
  .card.vitrine { border-top: 5px solid #9b59b6; }
  .frigo-name {
    font-weight: bold;
    margin-bottom: 10px;
    font-size: 1em;
  }
  .temperature {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f0f0f0;
    border-radius: 6px;
    padding: 8px;
  }
  .temperature input {
    font-size: clamp(1em, 4vw, 1.2em);
    font-weight: bold;
    width: 60%;
    text-align: right;
    border: none;
    background: transparent;
    box-sizing: border-box;
  }
  .temperature input::placeholder {
    color: #aaa;
    font-size: 1em;
  }
  .temperature .suffix {
    font-weight: bold;
    margin-left: 4px;
    font-size: clamp(1em, 4vw, 1.2em);
  }

  label, input[type="date"], select {
    display: block;
    width: 100%;
    margin-bottom: 12px;
    font-size: 1em;
  }
</style>
</head>
<body>

  <h2>Traçabilité température</h2>

  <label for="date">Date</label>
  <input type="date" id="date">

  <label for="operateur">Opérateur</label>
  <select id="operateur">
    <option value="Vanina">Vanina</option>
    <option value="Nicolas">Nicolas</option>
  </select>

  <label for="moment">Moment du relevé</label>
  <select id="moment">
    <option value="Matin">Matin</option>
    <option value="Après-midi">Après-midi</option>
  </select>

  <div class="alert" id="alert" style="display:none;"></div>

  <div class="grid" id="frigoGrid">
    <div class="group">
      <div class="separator">Cellules négatives</div>
      <div class="row" id="row1"></div>
    </div>
    <div class="group">
      <div class="separator">Cellules positives</div>
      <div class="row" id="row2"></div>
    </div>
    <div class="group">
      <div class="separator">Vitrines</div>
      <div class="row" id="row3"></div>
    </div>
    <div class="group">
      <div class="separator">Boisson</div>
      <div class="row single" id="row4"></div>
    </div>
  </div>

  <script>
    document.getElementById("date").valueAsDate = new Date();

    const cellules = [
      { nom: "CN1", type: "negatif", group: "row1" },
      { nom: "CN2", type: "negatif", group: "row1" },
      { nom: "CN3", type: "negatif", group: "row1" },
      { nom: "CP1", type: "positive", group: "row2" },
      { nom: "CP2", type: "verte", group: "row2" },
      { nom: "CP3", type: "verte", group: "row2" },
      { nom: "V1", type: "vitrine", group: "row3" },
      { nom: "V2", type: "vitrine", group: "row3" },
      { nom: "V3", type: "vitrine", group: "row3" },
      { nom: "BOISS 1", type: "boisson", group: "row4" }
    ];

    cellules.forEach((cellule, index) => {
      const row = document.getElementById(cellule.group);
      const card = document.createElement("div");
      card.className = `card ${cellule.type}`;
      card.innerHTML = `
        <div class="frigo-name">${cellule.nom}</div>
        <div class="temperature">
          <input type="number" step="0.1" id="temp${index}" placeholder="°C" onchange="checkTolerance(${index}, '${cellule.type}')">
          <span class="suffix">°C</span>
        </div>
      `;
      row.appendChild(card);
    });

    function checkTolerance(index, type) {
      const input = document.getElementById("temp" + index);
      let val = parseFloat(input.value);

      if (type === "negatif" && val > 0) {
        val = -Math.abs(val);
        input.value = val.toFixed(1);
      }

      const alertBox = document.getElementById("alert");
      input.style.backgroundColor = "#f0f0f0";

      if ((type === "negatif" && val > -10) || (type !== "negatif" && val > 8)) {
        alertBox.innerText = "Hors tolérance - Vérifiez température cellule";
        alertBox.style.display = "block";
        input.style.backgroundColor = "#ffcccc";
        setTimeout(() => alertBox.style.display = "none", 4000);
      }
    }
  </script>

</body>
</html>
